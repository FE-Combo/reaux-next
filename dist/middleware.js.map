{"version":3,"file":"middleware.js","sourceRoot":"","sources":["../framework/middleware.ts"],"names":[],"mappings":"AASA,IAAI,KAAe,CAAC;AACpB,IAAI,aAAa,GAAyB,IAAI,CAAC;AAE/C,MAAM,UAAU,uBAAuB;IACrC,MAAM,UAAU,GAAoB,CAClC,GAAkB,EAClB,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,EAAC,OAAO,EAAC,EAAE;QAC3B,IAAI,CAAC,OAAO,CAAC,CAAC;QACd,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE;YACzB,MAAM,IAAI,KAAK,CACb,qEAAqE,CACtE,CAAC;SACH;QACD,IAAI,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YACtC,IAAI;gBACF,MAAM,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;aAC3D;YAAC,OAAO,KAAK,EAAE;gBACd,aAAa,IAAI,aAAa,CAAC,KAAK,CAAC,CAAC;gBACtC,OAAO,CAAC,KAAK,CAAC,iBAAiB,KAAK,EAAE,CAAC,CAAC;aACzC;SACF;IACH,CAAC,CAAC;IAEF,UAAU,CAAC,GAAG,GAAG,UAAS,GAAa,EAAE,aAA6B;QACpE,KAAK,GAAG,GAAG,CAAC;QACZ,aAAa,GAAG,aAAa,CAAC;IAChC,CAAC,CAAC;IACF,OAAO,UAAU,CAAC;AACpB,CAAC;AAED,MAAM,CAAC,MAAM,eAAe,GAAoB,uBAAuB,EAAE,CAAC","sourcesContent":["import { Middleware, MiddlewareAPI } from \"redux\";\nimport { AppCache, Exception } from \"./type\";\n\ntype ErrorCallback = (exception: Exception) => void;\n\ninterface AsyncMiddleware extends Middleware {\n  run: (app: AppCache, errorCallback: ErrorCallback) => void;\n}\n\nlet cache: AppCache;\nlet errorCallback: ErrorCallback | null = null;\n\nexport function createPromiseMiddleware(): AsyncMiddleware {\n  const middleware: AsyncMiddleware = (\n    api: MiddlewareAPI\n  ) => next => async actions => {\n    next(actions);\n    if (!cache.actionHandlers) {\n      throw new Error(\n        \"Invoking action before execute async middleware.run function only!!\"\n      );\n    }\n    if (cache.actionHandlers[actions.type]) {\n      try {\n        await cache.actionHandlers[actions.type](actions.payload);\n      } catch (error) {\n        errorCallback && errorCallback(error);\n        console.error(`runtimeError: ${error}`);\n      }\n    }\n  };\n\n  middleware.run = function(app: AppCache, errorCallback?: ErrorCallback): any {\n    cache = app;\n    errorCallback = errorCallback;\n  };\n  return middleware;\n}\n\nexport const asyncMiddleware: AsyncMiddleware = createPromiseMiddleware();\n"]}